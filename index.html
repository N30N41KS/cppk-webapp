<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –ñ–î</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        html { background-color: var(--tg-theme-bg-color, #ffffff); height: 100%; overflow: hidden; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--tg-theme-bg-color, #ffffff); color: var(--tg-theme-text-color, #000000); margin: 0; padding: 20px; box-sizing: border-box; height: 100%; overflow-y: auto; -webkit-font-smoothing: antialiased; }
        h2 { text-align: center; margin-bottom: 20px; margin-top: 0; }
        .form-group { position: relative; margin-bottom: 20px; }
        label { display: block; font-weight: 500; margin-bottom: 8px; color: var(--tg-theme-hint-color, #999999); font-size: 14px; }
        input, textarea { width: 100%; box-sizing: border-box; padding: 14px; border: none; border-radius: 12px; background-color: var(--tg-theme-secondary-bg-color, #f4f4f5); color: var(--tg-theme-text-color, #000000); font-size: 16px; outline: none; transition: box-shadow 0.2s; }
        input:focus, textarea:focus { box-shadow: 0 0 0 2px var(--tg-theme-button-color, #3390ec); }
        textarea { resize: none; font-family: inherit; }
        button { width: 100%; padding: 16px; background-color: var(--tg-theme-button-color, #3390ec); color: var(--tg-theme-button-text-color, #ffffff); border: none; border-radius: 12px; font-size: 17px; font-weight: 600; cursor: pointer; margin-top: 10px; transition: opacity 0.2s; }
        button:active { opacity: 0.8; }
        .custom-dropdown { position: absolute; top: calc(100% + 5px); left: 0; right: 0; background-color: var(--tg-theme-bg-color, #ffffff); border-radius: 12px; max-height: 250px; overflow-y: auto; z-index: 1000; display: none; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
        .custom-dropdown.active { display: block; animation: fadeIn 0.1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-item { padding: 12px 16px; display: flex; align-items: center; cursor: pointer; border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #eee); }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover, .dropdown-item:active { background-color: var(--tg-theme-secondary-bg-color, #f4f4f5); }
        .icon-box { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; margin-right: 12px; flex-shrink: 0; }
        .station-name { font-size: 16px; font-weight: 500; }
    </style>
</head>
<body>
    <h2>üö® –°–æ–æ–±—â–∏—Ç—å –æ –ø–æ–ª–æ–º–∫–µ</h2>
    <div class="form-group">
        <label for="station-search">–°—Ç–∞–Ω—Ü–∏—è (–ú–µ—Ç—Ä–æ, –ú–¶–ö, –ú–¶–î):</label>
        <input type="text" id="station-search" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ..." autocomplete="off">
        <div style="position: absolute; right: 16px; top: 43px; color: var(--tg-theme-hint-color); pointer-events: none;">‚ñº</div>
        <div id="custom-stations-list" class="custom-dropdown"></div>
    </div>
    <div class="form-group">
        <label for="description">–ß—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å?</label>
        <textarea id="description" rows="5" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤—ã–π —Ç—É—Ä–Ω–∏–∫–µ—Ç..."></textarea>
    </div>
    <button id="submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–ø–æ—Ä—Ç</button>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor(tg.themeParams.bg_color || '#ffffff');
        tg.setBackgroundColor(tg.themeParams.bg_color || '#ffffff');

        const rawStations = [
            "–û–¥–∏–Ω—Ü–æ–≤–æ (D1)", "–ë–∞–∫–æ–≤–∫–∞ (D1)", "–°–∫–æ–ª–∫–æ–≤–æ (D1)", "–ù–µ–º—á–∏–Ω–æ–≤–∫–∞ (D1)", "–°–µ—Ç—É–Ω—å (D1)", "–†–∞–±–æ—á–∏–π –ü–æ—Å—ë–ª–æ–∫ (D1)", "–ö—É–Ω—Ü–µ–≤–æ (D1)", "–°–ª–∞–≤—è–Ω—Å–∫–∏–π –±—É–ª—å–≤–∞—Ä (D1)", "–§–∏–ª–∏ (D1)", "–¢–µ—Å—Ç–æ–≤—Å–∫–∞—è (D1)", "–ë–µ–≥–æ–≤–∞—è (D1)", "–ë–µ–ª–æ—Ä—É—Å—Å–∫–∞—è (D1)", "–°–∞–≤—ë–ª–æ–≤—Å–∫–∞—è (D1)", "–î–º–∏—Ç—Ä–æ–≤—Å–∫–∞—è (D1)",
            "–ü–æ–¥–æ–ª—å—Å–∫ (D2)", "–°–∏–ª–∏–∫–∞—Ç–Ω–∞—è (D2)", "–û—Å—Ç–∞—Ñ—å–µ–≤–æ (D2)", "–©–µ—Ä–±–∏–Ω–∫–∞ (D2)", "–ë—É—Ç–æ–≤–æ (D2)", "–ë–∏—Ç—Ü–∞ (D2)", "–ö—Ä–∞—Å–Ω—ã–π –°—Ç—Ä–æ–∏—Ç–µ–ª—å (D2)", "–ü–æ–∫—Ä–æ–≤—Å–∫–æ–µ (D2)", "–¶–∞—Ä–∏—Ü—ã–Ω–æ (D2)", "–ú–æ—Å–∫–≤–æ—Ä–µ—á—å–µ (D2)", "–ö—É—Ä—å—è–Ω–æ–≤–æ (D2)", "–ü–µ—Ä–µ—Ä–≤–∞ (D2)", "–î–µ–ø–æ (D2)", "–ü–µ—á–∞—Ç–Ω–∏–∫–∏ (D2)", "–¢–µ–∫—Å—Ç–∏–ª—å—â–∏–∫–∏ (D2)",
            "–ó–µ–ª–µ–Ω–æ–≥—Ä–∞–¥-–ö—Ä—é–∫–æ–≤–æ (D3)", "–°—Ö–æ–¥–Ω—è (D3)", "–ü–æ–¥—Ä–µ–∑–∫–æ–≤–æ (D3)", "–ù–æ–≤–æ–ø–æ–¥—Ä–µ–∑–∫–æ–≤–æ (D3)", "–•–∏–º–∫–∏ (D3)", "–•–æ–≤—Ä–∏–Ω–æ (D3)", "–ì—Ä–∞—á—ë–≤—Å–∫–∞—è (D3)", "–õ–∏—Ö–æ–±–æ—Ä—ã (D3)", "–ü–µ—Ç—Ä–æ–≤—Å–∫–æ-–†–∞–∑—É–º–æ–≤—Å–∫–∞—è (D3)", "–û—Å—Ç–∞–Ω–∫–∏–Ω–æ (D3)", "–≠–ª–µ–∫—Ç—Ä–æ–∑–∞–≤–æ–¥—Å–∫–∞—è (D3)", "–í—ã—Ö–∏–Ω–æ (D3)", "–õ—é–±–µ—Ä—Ü—ã (D3)", "–†–∞–º–µ–Ω—Å–∫–æ–µ (D3)",
            "–ê–ø—Ä–µ–ª–µ–≤–∫–∞ (D4)", "–í–Ω—É–∫–æ–≤–æ (D4)", "–ü–µ—Ä–µ–¥–µ–ª–∫–∏–Ω–æ (D4)", "–û—á–∞–∫–æ–≤–æ (D4)", "–ê–º–∏–Ω—å–µ–≤—Å–∫–∞—è (D4)", "–ú–∏–Ω—Å–∫–∞—è (D4)", "–ö—É—Ç—É–∑–æ–≤—Å–∫–∞—è (D4)", "–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è (D4)", "–ß—É—Ö–ª–∏–Ω–∫–∞ (D4)", "–ù–æ–≤–æ–≥–∏—Ä–µ–µ–≤–æ (D4)", "–†–µ—É—Ç–æ–≤ (D4)", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω–∞—è (D4)",
            "–û–∫—Ä—É–∂–Ω–∞—è (–ú–¶–ö)", "–í–ª–∞–¥—ã–∫–∏–Ω–æ (–ú–¶–ö)", "–ë–æ—Ç–∞–Ω–∏—á–µ—Å–∫–∏–π —Å–∞–¥ (–ú–¶–ö)", "–†–æ—Å—Ç–æ–∫–∏–Ω–æ (–ú–¶–ö)", "–õ–æ–∫–æ–º–æ—Ç–∏–≤ (–ú–¶–ö)", "–ò–∑–º–∞–π–ª–æ–≤–æ (–ú–¶–ö)", "–®–æ—Å—Å–µ –≠–Ω—Ç—É–∑–∏–∞—Å—Ç–æ–≤ (–ú–¶–ö)", "–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è (–ú–¶–ö)", "–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∞—è (–ú–¶–ö)", "–ü–ª–æ—â–∞–¥—å –ì–∞–≥–∞—Ä–∏–Ω–∞ (–ú–¶–ö)", "–õ—É–∂–Ω–∏–∫–∏ (–ú–¶–ö)", "–ö—É—Ç—É–∑–æ–≤—Å–∫–∞—è (–ú–¶–ö)", "–î–µ–ª–æ–≤–æ–π —Ü–µ–Ω—Ç—Ä (–ú–¶–ö)", "–®–µ–ª–µ–ø–∏—Ö–∞ (–ú–¶–ö)", "–•–æ—Ä–æ—à—ë–≤–æ (–ú–¶–ö)", "–ë–∞–ª—Ç–∏–π—Å–∫–∞—è (–ú–¶–ö)",
            "–°–æ–∫–æ–ª—å–Ω–∏–∫–∏ (–ú–µ—Ç—Ä–æ)", "–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–û—Ö–æ—Ç–Ω—ã–π –†—è–¥ (–ú–µ—Ç—Ä–æ)", "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–º–µ–Ω–∏ –õ–µ–Ω–∏–Ω–∞ (–ú–µ—Ç—Ä–æ)", "–ü–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã (–ú–µ—Ç—Ä–æ)", "–•–æ–≤—Ä–∏–Ω–æ (–ú–µ—Ç—Ä–æ)", "–í–æ–π–∫–æ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–î–∏–Ω–∞–º–æ (–ú–µ—Ç—Ä–æ)", "–¢–≤–µ—Ä—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è (–ú–µ—Ç—Ä–æ)", "–ü–∞–≤–µ–ª–µ—Ü–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–©—ë–ª–∫–æ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ë–∞—É–º–∞–Ω—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ö—É—Ä—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ü–ª–æ—â–∞–¥—å –†–µ–≤–æ–ª—é—Ü–∏–∏ (–ú–µ—Ç—Ä–æ)", "–ê—Ä–±–∞—Ç—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ö–∏–µ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ü—Ä–æ—Å–ø–µ–∫—Ç –ú–∏—Ä–∞ (–ú–µ—Ç—Ä–æ)", "–¢–∞–≥–∞–Ω—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–û–∫—Ç—è–±—Ä—å—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–í–î–ù–• (–ú–µ—Ç—Ä–æ)", "–ö–∏—Ç–∞–π-–≥–æ—Ä–æ–¥ (–ú–µ—Ç—Ä–æ)", "–¢—Ä–µ—Ç—å—è–∫–æ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ö—É–∑—å–º–∏–Ω–∫–∏ (–ú–µ—Ç—Ä–æ)", "–ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ü—É—à–∫–∏–Ω—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–¢–∏–º–∏—Ä—è–∑–µ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ú–µ–Ω–¥–µ–ª–µ–µ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–¶–≤–µ—Ç–Ω–æ–π –±—É–ª—å–≤–∞—Ä (–ú–µ—Ç—Ä–æ)", "–õ—é–±–ª–∏–Ω–æ (–ú–µ—Ç—Ä–æ)", "–ß–∫–∞–ª–æ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–¢—Ä—É–±–Ω–∞—è (–ú–µ—Ç—Ä–æ)", "–ê–≤–∏–∞–º–æ—Ç–æ—Ä–Ω–∞—è (–ú–µ—Ç—Ä–æ)", "–ê–ª–µ–∫—Å–µ–µ–≤—Å–∫–∞—è (–ú–µ—Ç—Ä–æ)", "–ê–ª—Ç—É—Ñ—å–µ–≤–æ (–ú–µ—Ç—Ä–æ)"
        ];

        // –ì–ï–û–ú–ï–¢–†–ò–Ø (–ë–ï–ó –•–ê–õ–¢–£–†–´)
        const getMcdSvg = (color, text) => `<svg viewBox="0 0 512 512" width="32" height="32"><g transform="translate(256, 256) skewX(-15) translate(-256, -256)"><rect x="80" y="116" width="352" height="280" rx="70" fill="${color}"/></g><text x="256" y="270" font-family="'Arial Black', Arial, sans-serif" font-weight="900" font-size="180" fill="#FFFFFF" text-anchor="middle" dominant-baseline="central">${text}</text></svg>`;
        
        // –ú–¶–ö: –ë–µ–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ + –ß–µ—Ä–Ω–∞—è 14
        const getMckSvg = () => `<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="800" height="1200" viewBox="0 0 600 900"><path d="M278 246.7c-26.9 2.6-41.5 5.5-61 12-81.2 27-143.7 98.5-161 184.2-16.4 81 9.6 164.3 69.1 221.6 63.5 61.1 153.8 83.9 237.1 59.9 91.1-26.2 157.5-102.7 173.5-199.9 2.5-15.6 2.5-54.4-.1-70-4.8-29.3-11.3-49.9-23.1-73.6-34.1-68-100.5-117.4-175.8-130.8-19.3-3.5-43.9-4.9-58.7-3.4" fill="#fff"/><g fill="red"><path d="M278 246.7c-26.9 2.6-41.5 5.5-61 12-81.2 27-143.7 98.5-161 184.2-16.4 81 9.6 164.3 69.1 221.6 63.5 61.1 153.8 83.9 237.1 59.9 91.1-26.2 157.5-102.7 173.5-199.9 2.5-15.6 2.5-54.4-.1-70-4.8-29.3-11.3-49.9-23.1-73.6-34.1-68-100.5-117.4-175.8-130.8-19.3-3.5-43.9-4.9-58.7-3.4m37.1 20.3c37.9 3.7 71.5 15.5 101.9 35.6 13.8 9.1 24 17.6 37.1 31 26.4 27.1 44.9 59 55.4 95.5 6.5 22.5 7.9 33.3 8 60.9 0 26.1-.9 34.4-6.1 55.1-20.2 81.2-85.8 144.7-168.7 163.3-67.1 15.1-138-1.7-189.6-44.9-94.9-79.4-109.5-219-32.8-314 8.8-10.9 28.1-29.5 39.7-38.1 44.8-33.5 101.3-49.7 155.1-44.4"/><path d="M273.8 296c-12.5 1.3-27.5 4.6-40.3 8.7C148.1 332.1 91.9 419.3 101 510.1c6.9 67.6 47.5 125.6 108.7 155.1 70 33.7 151.1 23.6 210.5-26.1 30-25.1 54.4-64.7 63.4-103 4.9-21 6.8-48.5 4.5-67.7-7-59.6-36.7-108.1-86.1-140.7-23.1-15.2-48.7-25.2-77.5-30.2-11-1.9-38.8-2.7-50.7-1.5m32.6 19.1c7.7.5 18.2 1.9 23.5 3 59.9 12.2 110.3 57.2 130.5 116.5 21.1 61.8 6.1 129-39.3 175.7-28.5 29.4-63.1 47.3-102.6 53.3-11.3 1.7-35.3 2-46.5.5-39.6-5.3-74-22.7-102-51.7-11.4-11.8-16.9-18.9-24.6-31.5-42.3-69.3-31.9-157.9 25.2-214.5 29.5-29.3 69.9-48 110.4-51.3 5.8-.4 10.7-.9 11-1 .3 0 6.8.4 14.4 1"/></g><path d="M180.1 390.2c-4 10.8-10.1 28.8-10.1 29.7 0 .8 5.5 1.1 18 1.1h18v166l18.3-.2c10-.2 18.1-.6 18-1.1-.2-.4-.3-45-.3-99.2V388h-61zm148.6 1c-.8 1.8-7.6 17.9-15.2 35.8-7.5 17.9-18.8 44.6-25.1 59.3L277 513.1V542h93v45h36v-45h10c5.5 0 10-.1 10-.3 0-.1 2.5-7.1 5.5-15.6s5.5-15.6 5.5-15.8c0-.1-7-.3-15.5-.3H406v-53h-36v53h-52.8l25.4-59.3c14-32.5 25.7-60 26-61 .5-1.6-.9-1.7-19-1.7H330z"/></svg>`;
        
        // –ú–ï–¢–†–û: –ò–¥–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä
        const getMetroSvg = () => `<svg viewBox="0 0 512 512" width="32" height="32"><path fill="#ED1B35" d="M110 380V130h90l56 85 56-85h90v250h-65V190l-81 125h-21l-81-125v190H110z"/></svg>`;

        function getOfficialSvgCode(stationName) {
            if (stationName.includes("(D1)")) return getMcdSvg("#F6A600", "D1");
            if (stationName.includes("(D2)")) return getMcdSvg("#E74280", "D2");
            if (stationName.includes("(D3)")) return getMcdSvg("#E95B0C", "D3");
            if (stationName.includes("(D4)")) return getMcdSvg("#40B181", "D4");
            if (stationName.includes("(–ú–¶–ö)")) return getMckSvg();
            return getMetroSvg(); 
        }

        const stations = rawStations.map(name => ({ name: name, iconCode: getOfficialSvgCode(name) }));
        const searchInput = document.getElementById('station-search');
        const dropdown = document.getElementById('custom-stations-list');
        let selectedStation = "";

        function renderList(filterText = "") {
            dropdown.innerHTML = "";
            const filtered = stations.filter(s => s.name.toLowerCase().includes(filterText.toLowerCase()));
            if (filtered.length === 0) { dropdown.classList.remove('active'); return; }
            filtered.sort((a, b) => a.name.localeCompare(b.name)).forEach(station => {
                let div = document.createElement('div');
                div.className = 'dropdown-item';
                div.innerHTML = `<div class="icon-box">${station.iconCode}</div> <span class="station-name">${station.name}</span>`;
                div.addEventListener('click', () => { searchInput.value = station.name; selectedStation = station.name; dropdown.classList.remove('active'); });
                dropdown.appendChild(div);
            });
            dropdown.classList.add('active');
        }

        searchInput.addEventListener('input', (e) => renderList(e.target.value));
        searchInput.addEventListener('focus', () => renderList(searchInput.value));
        document.addEventListener('click', (e) => { if (e.target !== searchInput && !dropdown.contains(e.target)) dropdown.classList.remove('active'); });

        document.getElementById('submit-btn').addEventListener('click', () => {
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            let descInput = document.getElementById('description').value.trim();
            let finalStation = selectedStation || searchInput.value.trim() || "–ù–µ —É–∫–∞–∑–∞–Ω–∞";
            if (!descInput) { tg.showAlert("–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É!"); return; }
            finalStation = finalStation.replace(/\s*\(.*?\)/, '').trim();
            tg.sendData(JSON.stringify({ station: finalStation, description: descInput }));
            setTimeout(() => tg.close(), 100);
        });
    </script>
</body>
</html>



