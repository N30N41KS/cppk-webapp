<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¶–ü–ü–ö –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        :root { --primary: #3db449; --surface: #f5f5f5; --radius: 28px; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; }
        body { background: var(--surface); color: #1c1b1f; padding-bottom: 20px; }
        .mui-nav { display: flex; justify-content: center; padding: 16px; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(15px); position: sticky; top: 0; z-index: 100; border-bottom: 2px solid var(--primary); }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; }
        .mui-card { background: #fff; border-radius: var(--radius); padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid #e8def8; }
        input, select, textarea { width: 100%; padding: 14px; border-radius: 16px; border: 1px solid #e8def8; background: #fafafa; font-size: 1rem; outline: none; margin-bottom: 15px; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: #fff; }
        .mui-btn { background: var(--primary); color: white; border: none; padding: 18px; width: 100%; border-radius: 16px; font-weight: 700; cursor: pointer; text-transform: uppercase; }
        #stationList { height: 150px; overflow-y: auto; }
    </style>
</head>
<body>

<nav class="mui-nav"><div class="logo" style="font-weight:700; color:var(--primary)">–¶–ü–ü–ö | –ú–û–ù–ò–¢–û–†–ò–ù–ì</div></nav>

<main class="container">
    <div class="mui-card">
        <h2 style="margin-bottom:20px; display:flex; align-items:center; gap:10px;"><span class="material-symbols-rounded" style="color:var(--primary)">report</span> –°–æ–∑–¥–∞—Ç—å —Ä–∞–ø–æ—Ä—Ç</h2>
        
        <label>üîç –ü–æ–∏—Å–∫ —Å—Ç–∞–Ω—Ü–∏–∏:</label>
        <input type="text" id="stationSearch" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –ê–≤–∏–∞...)" oninput="filterStations()">

        <label>üöâ –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞:</label>
        <select id="stationList" size="6">
            <option disabled>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π...</option>
        </select>

        <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–æ–º–∫–∏:</label>
        <textarea id="description" rows="4" placeholder="–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?"></textarea>

        <button class="mui-btn" onclick="sendData()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–ø–æ—Ä—Ç</button>
    </div>
</main>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let allStations = [];

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π (–∑–∞–º–µ–Ω–∏ –ø—É—Ç—å –Ω–∞ —Å–≤–æ–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    fetch('stations.json')
        .then(response => response.json())
        .then(data => {
            allStations = data;
            renderStations(allStations);
        })
        .catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–Ω—Ü–∏–π:', err);
            // –§–æ–ª–±—ç–∫, –µ—Å–ª–∏ JSON –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
            allStations = ["–ê–≤–∏–∞–º–æ—Ç–æ—Ä–Ω–∞—è", "–í—ã—Ö–∏–Ω–æ", "–ü–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã"]; 
            renderStations(allStations);
        });

    function renderStations(list) {
        const select = document.getElementById('stationList');
        select.innerHTML = '';
        list.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s;
            opt.textContent = s;
            select.appendChild(opt);
        });
    }

    function filterStations() {
        const query = document.getElementById('stationSearch').value.toLowerCase();
        const filtered = allStations.filter(s => s.toLowerCase().includes(query));
        renderStations(filtered);
    }

    function sendData() {
        const station = document.getElementById('stationList').value;
        const description = document.getElementById('description').value;
        if (!station || !description) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω—Ü–∏—é –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ!");
            return;
        }
        tg.sendData(JSON.stringify({ station, description }));
    }
</script>
</body>
</html>
